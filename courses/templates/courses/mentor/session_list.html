{% extends "base.html" %}
{% block content %}

<div class="flex min-h-screen w-full bg-slate-50 flex-col">
    <main class="flex-1 py-12">
        <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">

            <!-- HEADER -->
            <div class="mb-8 flex flex-wrap items-center justify-between gap-4">
                <h2 class="text-3xl font-bold tracking-tight text-gray-900">My Sessions</h2>
            </div>

            <!-- FILTERS -->
            <form method="get" class="mb-6 rounded-lg border border-gray-200 bg-white p-4">
                <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">

                    <!-- SEARCH -->
                    <div class="relative sm:col-span-2">
                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                            <span class="material-symbols-outlined text-gray-400">search</span>
                        </div>
                        <input
                            name="search"
                            value="{{ search }}"
                            class="block w-full rounded-md border-gray-300 bg-gray-50 pl-10 pr-4 py-2 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500"
                            placeholder="Search sessions..."
                            type="text" />
                    </div>

                    <!-- SORT + RANGE -->
                    <div class="flex items-center gap-2">

                        <!-- SORT dropdown -->
                        <select
                            name="sort"
                            class="block w-full rounded-md border-gray-300 bg-gray-50 px-3 py-2 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500">
                            
                            <option value="" {% if sort == "" %}selected{% endif %}>
                                Sort by Date (Newest)
                            </option>

                            <option value="oldest" {% if sort == "oldest" %}selected{% endif %}>
                                Sort by Date (Oldest)
                            </option>

                            <option value="title_asc" {% if sort == "title_asc" %}selected{% endif %}>
                                Sort by Title (A-Z)
                            </option>

                            <option value="title_desc" {% if sort == "title_desc" %}selected{% endif %}>
                                Sort by Title (Z-A)
                            </option>

                        </select>

                        <!-- UPCOMING / PAST TOGGLE -->
                        <div class="flex rounded-md bg-gray-50 p-0.5 w-96">
                            <button
                                type="submit"
                                name="range"
                                value="upcoming"
                                class="rounded-md px-3 py-1 text-sm font-medium ring-1 ring-inset ring-gray-300
                                {% if range == 'upcoming' %} bg-white text-gray-700 {% else %} text-gray-500 hover:bg-gray-100 {% endif %}">
                                Weekly Sessions
                            </button>

                            <button
                                type="submit"
                                name="range"
                                value="past"
                                class="rounded-md px-3 py-1 text-sm font-medium
                                {% if range == 'past' %} bg-white text-gray-700 ring-1 ring-inset ring-gray-300 {% else %} text-gray-500 hover:bg-gray-100 {% endif %}">
                                Past
                            </button>
                        </div>
                    </div>

                </div>
            </form>

            <!-- SESSION TABLE -->
            <div class="overflow-x-auto rounded-lg border border-gray-200 bg-white">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                                Session Title
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                                Type
                            </th>
                            {% if range == 'upcoming' %}
                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                                    Day
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                                    Time
                                </th>
                            {% else %}
                                <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                                    Held at
                                </th>
                            {% endif %}
                            <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
                                {% if range == 'upcoming' %}Session Link{% elif range == 'past' %}Recorded Session Link{% endif %}
                            </th>
                            <th class="relative px-6 py-3"><span class="sr-only">Actions</span></th>
                        </tr>
                    </thead>

                    <tbody class="divide-y divide-gray-200 bg-white">

                        {% for s in sessions %}
                        <tr>
                            <!-- TITLE -->
                            <td class="whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900">
                                {% if s.type == "group" %}
                                    {{ s.session.session_type.name_fa }} — {{ s.learning_path.name }}
                                {% elif s.type == "code_review" %}
                                    {{ s.learner.user.get_full_name }} — بررسی کد ({{ s.learning_path.name }})
                                {% elif s.type == "group_occurrence" %}
                                    {{ s.session_type.name_fa }} — {{ s.learning_path.name }}
                                {% elif s.type == "step_session" %}
                                    {{ s.learner.user.get_full_name }} — بررسی کد ({{ s.learning_path.name }})
                                {% endif %}
                            </td>

                            <!-- Type -->
                            <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500">
                                {% if s.type == "group" %}
                                    <span class="material-symbols-outlined">groups</span>
                                {% elif s.type == "code_review" %}
                                    <span class="material-symbols-outlined">person</span>
                                {% elif s.type == "group_occurrence" %}
                                    <span class="material-symbols-outlined">groups</span>
                                {% elif s.type == "step_session" %}
                                    <span class="material-symbols-outlined">person</span>
                                {% endif %}
                            </td>

                            {% if range == 'upcoming' %}
                            <!-- DAY -->
                            <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500">
                                {{ s.datetime|date:"l" }}
                            </td>

                            <!-- TIME -->
                            <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500">
                                {{ s.datetime|date:"g:i A" }}
                            </td>
                            {% else %}
                            <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500">
                                {{ s.datetime }}
                            </td>
                            {% endif %}

                            <!-- LINK -->
                            <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500">
                                {% if s.type == "group" %}
                                    <a class="inline-flex items-center gap-1.5 text-blue-600 hover:underline"
                                       href="{{ s.session.google_meet_link }}">
                                        <span class="material-symbols-outlined text-base">link</span> Join
                                    </a>
                                {% elif s.type == "code_review" %}
                                    <a class="inline-flex items-center gap-1.5 text-blue-600 hover:underline"
                                       href="{{ s.assignment.google_meet_link }}">
                                        <span class="material-symbols-outlined text-base">link</span> Join
                                    </a>
                                {% elif s.type == "group_occurrence" %}
                                    <a class="inline-flex items-center gap-1.5 text-blue-600 hover:underline"
                                        href="{{ s.occurrence.session_video_record }}">
                                        <span class="material-symbols-outlined text-base">link</span> View
                                    </a>
                                {% elif s.type == "step_session" %}
                                    <a class="inline-flex items-center gap-1.5 text-blue-600 hover:underline"
                                        href="{{ s.session.recorded_meet_link }}">
                                        <span class="material-symbols-outlined text-base">link</span> View
                                    </a>
                                {% endif %}
                            </td>

                            <!-- ACTIONS -->
                            <td class="whitespace-nowrap px-6 py-4 text-right text-sm font-medium">
                                {% if s.type == "group" %}
                                    <a class="inline-flex items-center gap-2 rounded-md bg-(--primary-color) text-white px-3 py-1.5 text-sm font-semibold text-primary-700 hover:bg-primary-200"
                                        href="{% url "group-session-attendance" s.session.id %}">
                                        <span class="material-symbols-outlined text-base">add</span>
                                        Add session occurrence
                                    </a>
                                {% elif s.type == "code_review" and s.step_progress %}
                                    <a class="inline-flex items-center gap-2 rounded-md bg-(--primary-color) text-white px-3 py-1.5 text-sm font-semibold text-primary-700 hover:bg-primary-200"
                                        href="{% url "private-session-manage" s.step_progress.id %}">
                                        <span class="material-symbols-outlined text-base">add</span>
                                        Add session occurrence
                                    </a>
                                {% elif s.type == "group_occurrence" %}
                                    <a class="inline-flex items-center gap-2 rounded-md bg-slate-100 px-3 py-1.5 text-sm font-semibold text-primary-700 hover:bg-primary-200"
                                        href="{% url "group-session-history" s.occurrence.id %}">
                                        <span class="material-symbols-outlined">folder</span>
                                        View History
                                    </a>
                                {% elif s.type == "step_session" %}
                                    <a class="inline-flex items-center gap-2 rounded-md bg-slate-100 px-3 py-1.5 text-sm font-semibold text-primary-700 hover:bg-primary-200"
                                        href="{% url "private-session-history" s.session.id %}">
                                        <span class="material-symbols-outlined">folder</span>
                                        View History
                                    </a>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-6 text-gray-500">
                                No sessions found.
                            </td>
                        </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>

        </div>
    </main>
</div>

{% endblock %}
