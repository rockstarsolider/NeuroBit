{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block content %}
<div class="relative flex h-auto min-h-screen w-full flex-col bg-slate-50 group/design-root overflow-x-hidden"
    style='font-family: Lexend, "Noto Sans", sans-serif;'>
    <div class="layout-container flex h-full grow flex-col">

        <main class="flex flex-1 justify-center py-10 px-4 sm:px-6 lg:px-8">
            <div class="layout-content-container flex w-full max-w-6xl flex-col gap-8">
                <div class="flex flex-col gap-2">
                    <div class="flex items-center justify-between">
                        <h1 class="text-3xl font-bold text-[var(--text-primary)]">{% trans "Feedback Queue"%}</h1>
                        <div class="flex items-center gap-2 rounded-lg bg-[var(--secondary-color)] px-4 py-2 text-sm">
                            <span class="font-semibold text-[var(--primary-color)]">{% trans "Tasks in Queue:"%}</span>
                            <span class="font-bold text-lg text-[var(--primary-color)]">{{pending_count}}</span>
                        </div>
                    </div>
                    <p class="text-[var(--text-secondary)]">{% trans "Manage and provide feedback on pending tasks."%}</p>
                </div>


                <div class="flex flex-col gap-4">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div class="relative flex-1 min-w-[300px]">
                            <span
                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-[var(--text-secondary)]">
                                search </span>
                            <input
                                name="q" hx-get="." hx-target="#submission-list" hx-trigger="keyup changed delay:300ms"
                                class="form-input w-full rounded-md border-slate-300 bg-white py-2.5 pl-10 pr-4 text-sm text-[var(--text-primary)] placeholder:text-[var(--text-secondary)] focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)]"
                                placeholder="Search tasks by title, learner..." type="search" />
                        </div>

                        <div class="flex flex-wrap gap-3">
                            <select
                                name="sort"
                                hx-get="."
                                hx-target="#submission-list"
                                hx-trigger="change"
                                class="h-10 rounded-md border border-slate-300 bg-white px-3 text-sm text-[var(--text-secondary)]"
                            >
                                <option value="">Sort by (Default)</option>
                                <option value="date">Date (Newest First)</option>
                                <option value="date_old">Date (Oldest First)</option>
                                <option value="task">Task Title</option>
                                <option value="learner">Learner Name</option>
                            </select>

                            <select
                                name="status"
                                hx-get="."
                                hx-target="#submission-list"
                                hx-trigger="change"
                                class="h-10 rounded-md border border-slate-300 bg-white px-3 text-sm text-[var(--text-secondary)]"
                            >
                                <option value="">Filter by Evaluation</option>
                                <option 
                                    value="evaluated"
                                    {% if request.GET.status == evaluated %}selected{% endif %}
                                >
                                    Evaluated
                                </option>
                                <option 
                                    value="pending"
                                    {% if request.GET.status == pending %}selected{% endif %}
                                >
                                    Pending
                                </option>
                            </select>
                        </div>
                    </div>


                    <div  class="overflow-x-auto rounded-lg border border-slate-200 bg-white">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b border-slate-200">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-xs font-semibold uppercase tracking-wider text-[var(--text-secondary)]">
                                        Task Title</th>
                                    <th
                                        class="px-6 py-3 text-xs font-semibold uppercase tracking-wider text-[var(--text-secondary)]">
                                        Learner</th>
                                    <th
                                        class="px-6 py-3 text-xs font-semibold uppercase tracking-wider text-[var(--text-secondary)]">
                                        Submission Date</th>
                                    <th
                                        class="px-6 py-3 text-xs font-semibold uppercase tracking-wider text-[var(--text-secondary)] text-right">
                                        Action</th>
                                </tr>
                            </thead>
                            <tbody id="submission-list" hx-get="{% url 'mentor-feedback-list' %}" hx-trigger="change from:#filters" class="divide-y divide-slate-200">
                                {% include 'courses/partials/mentor_feedback_table.html' %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}